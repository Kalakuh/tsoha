{% extends "layout.html" %}

{% block body %}
<p>
	<h2 class="display-4">Haku</h2>
	<form method="POST" action="{{ url_for('search') }}">
		<div class="form-group">
			<label>{{ form.contains.label }}</label>
			{{ form.contains(class_="form-control", placeholder="Sisältää") }}
			<ul>
				{% for error in form.contains.errors %}
					<li>{{ error }}</li>
				{% endfor %}
			</ul>
		</div>

		<div class="form-group">
			<label>{{ form.name.label }}</label>
			{{ form.name(class_="form-control", placeholder="Nimi") }}
			<ul>
				{% for error in form.name.errors %}
					<li>{{ error }}</li>
				{% endfor %}
			</ul>
		</div>

		<div class="form-group">
			<label>{{ form.after_date.label }}</label>
			{{ form.after_date(class_="form-control", placeholder="pp.kk.yyyy") }}
			<ul>
				{% for error in form.after_date.errors %}
					<li>{{ error }}</li>
				{% endfor %}
			</ul>
		</div>

		<div class="form-group">
			<label>{{ form.before_date.label }}</label>
			{{ form.before_date(class_="form-control", placeholder="pp.kk.yyyy") }}
			<ul>
				{% for error in form.before_date.errors %}
					<li>{{ error }}</li>
				{% endfor %}
			</ul>
		</div>

		<!-- WTForms adds <li> tags to RadioField, so we will use raw HTML instead -->
		{% if type != "post" %}
			<div class="form-group">
				<label>Hae</label>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="type" value="thread" checked>
					<label class="form-check-label">
						viestiketjua
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="type" value="post">
					<label class="form-check-label">
						viestiä
					</label>
				</div>
			</div>
		{% else %}
			<div class="form-group">
				<label>Hae</label>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="type" value="thread">
					<label class="form-check-label">
						viestiketjua
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="type" value="post" checked>
					<label class="form-check-label">
						viestiä
					</label>
				</div>
			</div>
		{% endif %}

		<div class="form-group">
			<label>Kuuluu kategoriaan</label>
			{% for category in categories %}
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="true" name="category{{ category.id }}">
					<label class="form-check-label">
						<span class="badge badge-secondary">{{ category.name }}</span>
					</label>
				</div>
			{% endfor %}
		</div>
		<input class="btn btn-primary btn-small" type="submit" value="Hae viestejä">
	</form>
	
	<hr>

	{% if type == "thread" %}
		{% if results|length > 0 %}
			{% for thread in results %}
				<div class="container">
					<h2 class="display-4"><a href="{{ url_for('get_thread', thread_id = thread.id )}}">{{ thread.topic }}</a></h2>
					{% for category in thread.categories %}
						<span class="badge badge-secondary">{{ category.name }}</span> 
					{% endfor %}
					</p>
					Kirjoittaja: {{ thread.sender.first_name }} {{ thread.sender.surname }}<br>
					Kirjoitettu: {{ thread.posted }}<br>
				</div>
				<hr class="my-4">
			{% endfor %}
		{% else %}
			<h2 class="display-4">Ei tuloksia.</h2>
		{% endif %}
	{% elif type == "post" %}
		{% if results|length > 0 %}
			{% for post in results %}
				<div class="post card" id="post{{ post.id }}">
					<div class="card-body">
						<h6 class="card-subtitle mb-2 text-muted">
							<small>
								<i>
									Julkaistu viestiketjussa: <a href="{{ url_for('get_thread', thread_id = post.thread_id) }}">
										{{ post.thread_topic }}
									</a>
								</i>
							</small>
						</h6>
						<hr>
						<h5 class="card-title">{{ post.sender.first_name }} {{ post.sender.surname }}</h5>
						
						<h6 class="card-subtitle mb-2 text-muted">
						{% if post.posted == post.modified %}
							<small>Julkaistu {{ post.posted }}</small>
						{% else %}
							<small>Muokattu {{ post.modified }}</small>
						{% endif %}
						</h6>

						<p class="card-text">
						<span style="white-space: pre-wrap; font-size: 16px">{{ post.content }}</span>
						</p>
					</div>
				</div>
				</p>
			{% endfor %}
		{% else %}
			<h2 class="display-4">Ei tuloksia.</h2>
		{% endif %}
	{% endif %}
</p>
{% endblock %}